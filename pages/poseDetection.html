<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="../styles/pose.css">
	<!-- Include below scripts if you want to use TF.js runtime. -->
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
	<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>


</head>

<body>
	<!-- Webcam video snapshot -->
	<div class="top-Container" id="topContainer">
		<video id="video" playsinline autoplay class="el-webcam"></video>
		<canvas id="skeleton" class="skeleton-webcam"></canvas>
		<canvas id="fpscanvas" style="display: none;"></canvas>
	</div>

	<script>
		'use strict';

		var exercise;
		async function captureFrame() {

			/* Get poses and skeleton image */
			const frameImg = getFpsImage();
			let poses = await detector.estimatePoses(frameImg);
			poses = poses[0];
			drawSkeleton(poses);

			/* return in case exercise does not exist */
			if (!exercise) return;

			/* Restart steps for the exercise */
			if (exerciseStep > exercise?.totalSteps) {
				exercise.exStep = -1;
				exerciseStep = 0;
				repCount++;
				sendReps(repCount);
			}

			/* Process exercises steps, angles etc. */
			const doneCorrectly = exerciseDetect(poses, exercise);
			/*
				exercise?.exStep = 0 ;  exerciseStep= 1 -> detects step 1 [x,1,x]
				exercise?.exStep = 1 ;  exerciseStep= 2 -> detects step 2 [x,x,2]
			*/
			if (!(doneCorrectly.includes(false))) {
				exercise.exStep = exerciseStep;
				exerciseStep++;
			}


			//return before 5 seconds 
			if (!startTest) {
				return;
			}

		}


	</script>


	<script src="../scripts/IframeMsgs/send.js"></script>
	<script src="../scripts/IframeMsgs/recieve.js"></script>
	<script src="../scripts/poseDetectionJs/model.js"></script>
	<script src="../scripts/poseDetectionJs/loadwebcam.js"></script>
	<script src="../scripts/poseDetectionJs/constantsandvars.js"></script>
	<script src="../scripts/poseDetectionJs/skeletonWebcam.js"></script>
	<script src="../scripts/poseDetectionJs/exerciseDetection.js"></script>
	<script src="../scripts/poseDetectionJs/intervals.js"></script>
	<script src="../scripts/poseDetectionJs/testStatus.js"></script>

</body>

</html>